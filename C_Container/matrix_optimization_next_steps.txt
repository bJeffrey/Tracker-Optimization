Refined Next Steps Plan (Event-Driven Tracker + AER Measurements)

Step 0 — Naming + ownership split (clarity)
1) Rename current sim-side SoA to a truth namespace/type:
   - truth::TruthBatchSoA (authoritative truth kinematics)
2) Establish tracker-side containers:
   - trk::TrackBatchSoA (estimated state, SoA slab)
   - trk::TrackMeta (track_id, status, quality, timestamps)
   - trk::TrackCovBatch (P storage) — can remain interleaved batch at first

Step 1 — Time bookkeeping (event-driven foundation)
3) Add per-track prediction time:
   - t_pred_s[i] meaning state+cov aged to this time (recommended single timestamp)
4) Replace “predict every dt for tracker” with:
   - EnsurePredictedToTime(ids, t_event, flags)
5) Keep truth sim loop (dt-based) only for generating truth and measurements.

Step 2 — Prediction (state + covariance) as reusable kernels
6) Implement CA9 state prediction for subsets (SoA slab).
7) Implement CA9 covariance prediction for subsets:
   - preferred: P ← F P Fᵀ + Qd(dt)
   - if deferring full FPFᵀ: keep RW as placeholder, but FLAG it as “not KF-correct”
8) For CT tracks initially:
   - predict state with CT model (already exists)
   - predict covariance using CA9 predictor as a first approximation (baseline gating)

Step 3 — Measurement generation in AER (truth → measurements)
9) Add AER measurement generator:
   - for each scan: from truth::TruthBatchSoA produce meas::ScanMeasAER
   - include Pd, misses, clutter, noise
10) Store measurement time t_scan and sensor id.

Step 4 — Gating in the right frames
11) Coarse gate: spatial index AABB (ECEF) → candidate tracks.
12) For those candidates:
   - EnsurePredictedToTime(candidate_ids, t_scan, need_state=true, need_cov=true)
13) Fine gate: compute z_pred_aer and S in AER; Mahalanobis gate.

Step 5 — Association plugin architecture
14) Define assoc::AssocProblem + assoc::IAssociator.
15) Implement assoc::GnnAssociator first.
16) Ensure the tracker calls associator via the interface only (no direct coupling).

Step 6 — Track update + management + publish policy
17) EKF update in AER for assigned tracks.
18) Unassigned logic:
   - misses → track score down
   - clutter/spurious → tentative tracks with low quality
19) Confirm/tentative rules + publish filter (“don’t publish low-confidence”).

Notes
- Tracker estimate propagation is EVENT-DRIVEN (scan, offboard request, incoming remote track, etc.).
- Truth simulation can remain dt-based for deterministic scenario generation.
- Recommended consistency rule: state and covariance share the same “aged-to” timestamp (t_pred_s).
